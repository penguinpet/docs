---
title: Computed Columns
summary: A computed column stores data generated by an expression included in the column definition.
toc: false
---

<span class="version-tag">New in v2.0:</span> A computed column stores data generated from other columns by an [expression](sql-expressions.html) included in the column definition.

<div id="toc"></div>

## Why use computed columns?

Computed columns are especially useful when used with [partitioning](partitioning.html) or [`JSONB`](jsonb.html) columns.

**Partitioning** requires that partitions are defined using columns that are a prefix of the primary key. In the case of geo-partitioning, some applications will want to collapse the number of possible values in this column, to make certain classes of queries more performant (see Query planning changes in the RFC for details). For example, if a users table has a country and state column, then a CockroachDB operator could make a stored computed column locality with a reduced domain for use in partitioning. For more information, see the [partitioning example](#create-a-table-with-a-jsonb-column-and-computed-column) below.

**JSONB** When the primary source of truth for a table lives in a JSON blob, it can be desirable to put an index on a particular field of a JSON document. In particular, computed columns allow for the following use-case: a two column table, with a primary key column and a payload column, whose primary key is computed as some field from the payload column. This alleviates the need for the client to manually separate their JSON blobs from their primary keys. For more information, see the [`JSONB` example](#create-a-table-with-geo-partitions-and-a-computed-column) below.


## Considerations

Computed columns:

- Cannot be added once a table is created.
- Cannot reference other computer columns.
- Behave like any other column, with the exception that they cannot be written to directly.
- Are mutually exclusive with [`DEFAULT`](default-value.html).

## Creation

Computed columns can only be added at the time of [table creation](create-table.html). Use the following syntax:

~~~
column_name <type> AS <expr> [ STORED | VIRTUAL]
~~~

Parameter | Description
----------|------------
`column_name` | The [name/identifier](keywords-and-identifiers.html#identifiers) of the computed column.
`<type>` | The [data type](data-types.html) of the computed column.
`<expr>` | The pure [expression](sql-expressions.html) used to compute column values. Any functions marked as `impure`, such as `now()` or `nextval()` cannot be used.
`STORED` | _(Default)_ The computed column is stored alongside other columns. This is required if the column appears in the [Primary Key](primary-key.html).
`VIRTUAL` | The computed column is only computed when rows are read.

## Examples

### Create a table with a computed column

In this example, let's create a simple table

### Create a table with geo-partitions and a computed column


### Create a table with a `JSONB` column and computed column






## See Also

- [Value Expressions](sql-expressions.html)
- [Information Schema](information-schema.html)
- [Define Table Partitions (Enterprise)](partitioning.html)
- [`CREATE TABLE`](create-table.html)
- [`JSONB`](jsonb.html)
